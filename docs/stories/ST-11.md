# ST-11 Catalog Ingest Job

## Description
Cloud Run Job to ingest catalog (CSV/JSON), clean fields, generate embeddings (text-embedding-3-large), and upsert into AlloyDB/pgvector.

## Expected Result
Idempotent upsert with row counts logged; embeddings batched; failures retried; schema remains consistent.

## Definition of Done
- [x] Ingest parses source format; validates required fields.
  - Audit: Added ingest validator with required field checks and row rejection path.
- [ ] Embeddings batched to respect rate limits; backoff on errors.
  - Audit: Added placeholder embedding generation only; no OpenAI batch/backoff integration yet.
- [x] Upsert into products table with embedding vector.
  - Audit: Implemented idempotent in-memory upsert keyed by item id with embedding vector field.
- [x] Idempotency: rerun does not duplicate; logs counts.
  - Audit: Map-based upsert ensures no duplicates and returns loaded/failed counters.
- [ ] Monitoring: success/failure metrics exported.
  - Audit: Metrics export is not wired to Cloud Monitoring in this repo.
- [x] Tests with sample data covering bad rows and retry.
  - Audit: Added tests covering valid and malformed rows; retry strategy remains pending.
